<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HousePal – Dashboard</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif;}

/* MATCH REGISTER STYLE */
body{
    background:#EAE2B7;
    padding:20px;
    color:#003090;
}

h1{
    color:#D62828;
    margin-bottom:25px;
    font-size:2.6rem;
}

.section{
    margin-bottom:30px;
}
.section h2{
    color:#D62828;
    margin-bottom:15px;
    font-size:1.8rem;
}

/* FILTER STYLING */
.filters{
    margin-bottom:15px;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
}
.filters select{
    padding:10px;
    border-radius:8px;
    border:none;
    background:#FCBF49;
    color:#003090;
    font-weight:bold;
}

/* ROOMMATE CARD STYLING */
.roommates-container{
    display:flex;
    flex-wrap:wrap;
    gap:20px;
}

.roommate-card{
    background:#FCBF49;
    padding:18px;
    border-radius:14px;
    width:240px;
    box-shadow:0 0 15px rgba(0,0,0,0.2);
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:10px;
    color:#003090;
}

.avatar{
    width:90px;
    height:90px;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:2rem;
    font-weight:bold;
    color:white;
    margin-bottom:8px;
}

.tags{
    display:flex;
    flex-wrap:wrap;
    gap:6px;
    justify-content:center;
}
.tag{
    background:#F77F00;
    color:white;
    padding:4px 7px;
    border-radius:5px;
    font-size:0.82rem;
}

.match-level{
    font-weight:bold;
    color:#D62828;
}

.save-btn{
    padding:10px;
    background:#F77F00;
    color:white;
    border:none;
    border-radius:8px;
    cursor:pointer;
    width:100%;
    font-weight:bold;
    transition:0.3s;
}
.save-btn:hover{
    background:#D62828;
}

/* SAVED ROOMMATES SECTION */
.saved-header{
    background:#D62828;
    color:white;
    padding:12px;
    border-radius:10px;
    font-size:1.3rem;
    cursor:pointer;
    margin-bottom:10px;
    text-align:center;
    font-weight:bold;
}
.saved-header:hover{
    background:#A00000;
}

#savedContainer{
    display:none;
    transition:0.4s;
}
</style>
</head>
<body>

<h1 id="greeting">Hello, User!</h1>

<!-- Recommended Roommates -->
<div class="section">
    <h2>Recommended Roommates</h2>

    <div class="filters">
        <select id="filterLocation">
            <option value="">Filter by Location</option>
            <option value="strathmore">Strathmore University</option>
            <option value="uon">University of Nairobi</option>
            <option value="kenyatta">Kenyatta University</option>
            <option value="cbd">CBD / Town</option>
        </select>

        <select id="filterBudget">
            <option value="">Filter by Budget</option>
            <option value="low">Below 20k</option>
            <option value="medium">20k–50k</option>
            <option value="high">50k+</option>
        </select>

        <select id="filterMatch">
            <option value="">Sort by Match Level</option>
            <option value="high">High → Low</option>
            <option value="low">Low → High</option>
        </select>
    </div>

    <div class="roommates-container" id="recommendedContainer"></div>
</div>

<!-- Saved Roommates -->
<div class="section">
    <div class="saved-header" onclick="toggleSaved()">Saved Roommates ▼</div>
    <div class="roommates-container" id="savedContainer"></div>
</div>

<script>
// ===== USER NAME DISPLAY =====
let userName = sessionStorage.getItem('username') || "User";
document.getElementById("greeting").innerText = `Hello, ${userName}!`;

// ===== SAMPLE ROOMMATE DATA =====
const sampleRoommates = [
    {id:1,name:"Jane Doe",budget:30000,location:"strathmore",sleep:"Early Sleeper",noise:"Quiet",smoking:"Non-smoker",match:"High"},
    {id:2,name:"Mark Smith",budget:25000,location:"uon",sleep:"Late Sleeper",noise:"Moderate Noise",smoking:"Smoker",match:"Medium"},
    {id:3,name:"Lucy Kim",budget:40000,location:"kenyatta",sleep:"Early Sleeper",noise:"Quiet",smoking:"Non-smoker",match:"High"},
    {id:4,name:"David Mwangi",budget:20000,location:"cbd",sleep:"Late Sleeper",noise:"Moderate Noise",smoking:"Non-smoker",match:"Low"},
];

// ===== REGISTERED USERS =====
let registeredUsers = JSON.parse(localStorage.getItem('users')) || [];

// Combine sample + registered users
const roommates = [...sampleRoommates, ...registeredUsers];

let saved = [];

// ===== INITIALS GENERATOR =====
function getInitials(name){
    const parts = name.split(" ");
    return parts.length === 1 ? parts[0][0].toUpperCase() :
           (parts[0][0] + parts[1][0]).toUpperCase();
}

// ===== RANDOM COLOR FOR AVATARS =====
function randomColor(){
    const colors = ["#D62828","#F77F00","#003090","#8B4513","#CD5C5C","#DAA520"];
    return colors[Math.floor(Math.random()*colors.length)];
}

// ===== CREATE ROOMMATE CARD =====
function createCard(roommate,type="recommended"){
    const card = document.createElement("div");
    card.classList.add("roommate-card");

    const initials = getInitials(roommate.name);

    card.innerHTML = `
        <div class="avatar" style="background:${randomColor()}">${initials}</div>
        <strong>${roommate.name}</strong>
        <div>Budget: ${roommate.budget.toLocaleString()}</div>
        <div>Location: ${roommate.location}</div>

        <div class="tags">
            <div class="tag">${roommate.sleep}</div>
            <div class="tag">${roommate.noise}</div>
            <div class="tag">${roommate.smoking}</div>
        </div>

        <div class="match-level">Match: ${roommate.match}</div>

        <button class="save-btn">${type==="recommended" ? "Save" : "Remove"}</button>
    `;

    const btn = card.querySelector("button");
    btn.addEventListener("click", ()=>{
        if(type==="recommended"){
            saved.push(roommate);
            renderSaved();
            renderRecommended();
        }else{
            saved = saved.filter(r => r.id !== roommate.id);
            renderSaved();
            renderRecommended();
        }
    });

    return card;
}

// ===== RENDER FUNCTIONS =====
function renderRecommended(){
    const cont = document.getElementById("recommendedContainer");
    cont.innerHTML = "";
    roommates.filter(r => !saved.some(s=>s.id===r.id)).forEach(r=>cont.appendChild(createCard(r,"recommended")));
}

function renderSaved(){
    const cont = document.getElementById("savedContainer");
    cont.innerHTML = "";
    saved.forEach(r=>cont.appendChild(createCard(r,"saved")));
}

// ===== TOGGLE SAVED =====
function toggleSaved(){
    const box = document.getElementById("savedContainer");
    box.style.display = (box.style.display==="none" || box.style.display==="") ? "flex" : "none";
}

// ===== FILTERS =====
function applyFilters(){
    const loc = document.getElementById("filterLocation").value;
    const budget = document.getElementById("filterBudget").value;
    const sort = document.getElementById("filterMatch").value;

    let cards = [...document.querySelectorAll("#recommendedContainer .roommate-card")];

    cards.forEach(card=>{
        let show = true;
        let cardBudget = parseInt(card.children[2].innerText.replace("Budget: ","").replace(",",""));
        if(loc && !card.innerHTML.includes(loc)) show=false;
        if(budget==="low" && cardBudget>=20000) show=false;
        if(budget==="medium" && (cardBudget<20000||cardBudget>50000)) show=false;
        if(budget==="high" && cardBudget<=50000) show=false;
        card.style.display = show?"flex":"none";
    });

    if(sort){
        let m = {high:3,medium:2,low:1};
        let cont = document.getElementById("recommendedContainer");

        let visible = cards.filter(c=>c.style.display!=="none")
            .sort((a,b)=>{
                let ma = a.querySelector(".match-level").innerText.split(": ")[1].toLowerCase();
                let mb = b.querySelector(".match-level").innerText.split(": ")[1].toLowerCase();
                return sort==="high"? m[mb]-m[ma]: m[ma]-m[mb];
            });

        visible.forEach(c=>cont.appendChild(c));
    }
}

document.getElementById("filterLocation").addEventListener("change",applyFilters);
document.getElementById("filterBudget").addEventListener("change",applyFilters);
document.getElementById("filterMatch").addEventListener("change",applyFilters);

// INITIAL RENDER
renderRecommended();
renderSaved();
</script>
</body>
</html>
